CREATE TABLE `users` (
  `USER_ID` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `USERNAME` VARCHAR(45) NOT NULL,
  `PASSWORD` VARCHAR(45) NOT NULL,
  `ENABLED` tinyint(1) NOT NULL,
  PRIMARY KEY (`USER_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `user_roles` (
  `USER_ROLE_ID` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `USER_ID` INT(10) UNSIGNED NOT NULL,
  `AUTHORITY` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`USER_ROLE_ID`),
  KEY `FK_user_roles` (`USER_ID`),
  CONSTRAINT `FK_user_roles` FOREIGN KEY (`USER_ID`) REFERENCES `users` (`USER_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `patient` (
  `PATIENT_ID` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `USER_ID` INT(10) UNSIGNED NOT NULL,
  `PATIENT_NAME` VARCHAR(255) NOT NULL,
  `DATE_OF_BIRTH` DATE NOT NULL,
  `GENDER` VARCHAR(45) NOT NULL,
  `LOCATION` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`PATIENT_ID`),
  KEY `FK_patient` (`USER_ID`),
  CONSTRAINT `FK_patient` FOREIGN KEY (`USER_ID`) REFERENCES `users` (`USER_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `patient_medication` (
  `MEDICATION_ID` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `PATIENT_ID` INT(10) UNSIGNED NOT NULL,
  `MEDICATION_NAME` VARCHAR(255) NOT NULL,
  `NOTES` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`MEDICATION_ID`),
  KEY `FK_patient_medication` (`PATIENT_ID`),
  CONSTRAINT `FK_patient_medication` FOREIGN KEY (`PATIENT_ID`) REFERENCES `patient` (`PATIENT_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `patient_file` (
   `FILE_ID` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
   `PATIENT_ID` INT(10) UNSIGNED NOT NULL,
   `FILE_NAME` VARCHAR(255) NOT NULL,
   `DESCRIPTION` VARCHAR(255) NOT NULL,
   `FILE_URL` VARCHAR(255) NOT NULL,
   PRIMARY KEY (`FILE_ID`),
   KEY `FK_patient_file` (`PATIENT_ID`),
   CONSTRAINT `FK_patient_file` FOREIGN KEY (`PATIENT_ID`) REFERENCES `patient` (`PATIENT_ID`)
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8;
 

CREATE TABLE `doctor` (
  `DOCTOR_ID` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `USER_ID` INT(10) UNSIGNED NOT NULL,
  `DOCTOR_NAME` VARCHAR(255) NOT NULL,
  `DATE_OF_BIRTH` DATE NOT NULL,
  `GENDER` VARCHAR(45) NOT NULL,
  `QUALIFYING_DEGREE` VARCHAR(45) NOT NULL,
  `AREA_OF_PRACTICE` VARCHAR(255) NOT NULL,
  `LICENSE_NUMBER` VARCHAR(255) NOT NULL,
  `ACHIEVEMENTS` VARCHAR(255)  NULL,
  PRIMARY KEY (`DOCTOR_ID`),
  KEY `FK_doctor` (`USER_ID`),
  CONSTRAINT `FK_doctor` FOREIGN KEY (`USER_ID`) REFERENCES `users` (`USER_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `conversation` (
  `CONVERSATION_ID` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `PATIENT_ID` INT(10) UNSIGNED NOT NULL,
  `DOCTOR_ID` INT(10) UNSIGNED NULL,
  `TITLE` VARCHAR(1000) NOT NULL,
  `START_DATE` DATETIME NOT NULL,
  `UPDATE_DATE` DATETIME NOT NULL,
  `UNANSWERED` tinyint(1) NOT NULL,
  `LIKES` INT(100) NOT NULL DEFAULT 0,
  `DISLIKES` INT(100) NOT NULL DEFAULT 0,
  PRIMARY KEY (`CONVERSATION_ID`),
  KEY `FK_conversation1` (`PATIENT_ID`),
  KEY `FK_conversation2` (`DOCTOR_ID`),
  CONSTRAINT `FK_conversation1` FOREIGN KEY (`PATIENT_ID`) REFERENCES `patient` (`PATIENT_ID`),
  CONSTRAINT `FK_conversation2` FOREIGN KEY (`DOCTOR_ID`) REFERENCES `doctor` (`DOCTOR_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `comment` (
  `COMMENT_ID` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `CONVERSATION_ID` INT(10) UNSIGNED NOT NULL,
  `USER_ID` INT(10) UNSIGNED NOT NULL,
  `TEXT` VARCHAR(255) NOT NULL,
  `COMMENT_DATE` DATETIME NOT NULL,
  PRIMARY KEY (`COMMENT_ID`),
  KEY `FK_comment1` (`CONVERSATION_ID`),
  KEY `FK_comment2` (`USER_ID`),
  CONSTRAINT `FK_comment1` FOREIGN KEY (`CONVERSATION_ID`) REFERENCES `conversation` (`CONVERSATION_ID`),
  CONSTRAINT `FK_comment2` FOREIGN KEY (`USER_ID`) REFERENCES `users` (`USER_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `patient_symptom` (
  `SYMPTOM_ID` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `PATIENT_ID` INT(10) UNSIGNED NOT NULL,
  `SYMPTOM_NAME` VARCHAR(255) NOT NULL,
  `NOTES` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`SYMPTOM_ID`),
  KEY `FK_patient_symptom` (`PATIENT_ID`),
  CONSTRAINT `FK_patient_symptom` FOREIGN KEY (`PATIENT_ID`) REFERENCES `patient` (`PATIENT_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `patient_allergy` (
  `ALLERGY_ID` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `PATIENT_ID` INT(10) UNSIGNED NOT NULL,
  `ALLERGY_NAME` VARCHAR(255) NOT NULL,
  `NOTES` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`ALLERGY_ID`),
  KEY `FK_patient_allergy` (`PATIENT_ID`),
  CONSTRAINT `FK_patient_allergy` FOREIGN KEY (`PATIENT_ID`) REFERENCES `patient` (`PATIENT_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `patient_procedure` (
  `PROCEDURE_ID` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `PATIENT_ID` INT(10) UNSIGNED NOT NULL,
  `PROCEDURE_NAME` VARCHAR(255) NOT NULL,
  `NOTES` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`PROCEDURE_ID`),
  KEY `FK_patient_procedure` (`PATIENT_ID`),
  CONSTRAINT `FK_patient_procedure` FOREIGN KEY (`PATIENT_ID`) REFERENCES `patient` (`PATIENT_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `follow_doctor` (
  `FOLLOW_ID` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `PATIENT_ID` INT(10) UNSIGNED NOT NULL,
  `DOCTOR_ID` INT(10) UNSIGNED NOT NULL,
  PRIMARY KEY (`FOLLOW_ID`),
  KEY `FK_follow_doctor1` (`PATIENT_ID`),
  KEY `FK_follow_doctor2` (`DOCTOR_ID`),
  CONSTRAINT `FK_follow_doctor1` FOREIGN KEY (`PATIENT_ID`) REFERENCES `patient` (`PATIENT_ID`),
  CONSTRAINT `FK_follow_doctor2` FOREIGN KEY (`DOCTOR_ID`) REFERENCES `doctor` (`DOCTOR_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `review` (
  `REVIEW_ID` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `PATIENT_ID` INT(10) UNSIGNED NOT NULL,
  `DOCTOR_ID` INT(10) UNSIGNED NOT NULL,
  `TEXT` VARCHAR(255) NOT NULL,
  `REVIEW_DATE` DATETIME NOT NULL,
  `RATING` INT(10) UNSIGNED NOT NULL,
  PRIMARY KEY (`REVIEW_ID`),
  KEY `FK_review1` (`PATIENT_ID`),
  KEY `FK_review2` (`DOCTOR_ID`),
  CONSTRAINT `FK_review1` FOREIGN KEY (`PATIENT_ID`) REFERENCES `patient` (`PATIENT_ID`),
  CONSTRAINT `FK_review2` FOREIGN KEY (`DOCTOR_ID`) REFERENCES `doctor` (`DOCTOR_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE users MODIFY COLUMN password VARCHAR(255) NOT NULL;
ALTER TABLE patient ADD COLUMN PROFILE_PIC_URL VARCHAR(1000) NOT NULL DEFAULT 'https://s3-us-west-2.amazonaws.com/secondopinion/profile_pictures/user_anonymous.png';
ALTER TABLE doctor ADD COLUMN PROFILE_PIC_URL VARCHAR(1000) NOT NULL DEFAULT 'https://s3-us-west-2.amazonaws.com/secondopinion/profile_pictures/user_anonymous.png';

INSERT INTO users (USER_ID, USERNAME,PASSWORD, ENABLED) VALUES (100, 'jeff@gmail.com', 'password', TRUE);
INSERT INTO users (USER_ID, USERNAME,PASSWORD, ENABLED) VALUES (105, 'david@gmail.com', 'password', TRUE);

INSERT INTO user_roles (USER_ROLE_ID, USER_ID,AUTHORITY) VALUES (1, 100, 'ROLE_USER');

INSERT INTO patient (USER_ID, PATIENT_NAME, DATE_OF_BIRTH, GENDER, LOCATION) VALUES (100, 'Jeff Yellow', '1974-02-18', 'Male', 'Los Angeles');

INSERT INTO patient_medication (PATIENT_ID, MEDICATION_NAME, NOTES) VALUES (1, 'Advil', 'For back pain. Once a day.');

INSERT INTO doctor (USER_ID, DOCTOR_NAME, DATE_OF_BIRTH, GENDER, QUALIFYING_DEGREE, AREA_OF_PRACTICE, LICENSE_NUMBER, ACHIEVEMENTS) 
VALUES (105, 'Susan A. Mitchell', '1964-07-20', 'Female', 'MD', 'Pediatrics', 'A1B2C3D4', 'Board Certified');